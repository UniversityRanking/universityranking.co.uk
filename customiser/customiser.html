---
layout: default
title: Customiser
---

<!-- Load Tabulator for future proofing -->
<link href="https://unpkg.com/tabulator-tables@5.4.3/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@5.4.3/dist/js/tabulator.min.js"></script>

<style>
  body {
    font-family: 'Helvetica Neue', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #ffffff;
    color: #333;
  }

  .hero {
    background-color: #3b0a66;
    padding: 5rem 1rem 3rem 1rem;
    text-align: center;
    color: white;
  }

  .customiser-section {
    background-color: #f5f5ff;
    padding: 4rem 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .customiser-container {
    max-width: 1000px;
    width: 100%;
    background: white;
    border-radius: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    padding: 2rem;
  }

  .question-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .question-label {
    width: 75%;
    font-size: 1rem;
  }

  .slider {
    width: 20%;
  }

  .submit-button {
    background-color: #3b0a66;
    color: white;
    font-size: 1rem;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 2rem;
  }

  .ranking-table {
    margin-top: 2rem;
    width: 100%;
    border-collapse: collapse;
    font-size: 1rem;
  }

  .ranking-table th, .ranking-table td {
    border: 1px solid #ddd;
    padding: 0.75rem;
    text-align: center;
  }

  .ranking-table th {
    background-color: #f0f0f0;
  }
</style>

<section class="hero">
  <h2 class="compare-title">Customise University Rankings</h2>
</section>

<section class="customiser-section">
  <div class="customiser-container">
    <label for="subject-select">Select Subject:</label>
    <select id="subject-select"></select>

    <div id="sliders"></div>

    <button class="submit-button" onclick="calculateCustomRanking()">Submit</button>

    <table class="ranking-table" id="results-table" style="display: none;">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Change</th>
          <th>University</th>
          <th>Weighted Score</th>
          <th>Original Score</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<script>
let allData = [];
let weights = {};
let questions = [];
let originalRanks = {};

fetch("../assets/tables/All-Subjects-Formatted.json")
  .then(res => res.json())
  .then(data => {
    allData = data;
    const subjects = [...new Set(data.map(row => row.Subject))].sort();
    const subjectSelect = document.getElementById("subject-select");
    subjects.forEach(subject => {
      const opt = document.createElement("option");
      opt.value = subject;
      opt.textContent = subject;
      subjectSelect.appendChild(opt);
    });

    const sample = data.find(row => row.Subject === subjects[0]);
    questions = Object.keys(sample).filter(k => /^Q\d+$/.test(k));
    createSliders();
  });

function createSliders() {
  const slidersDiv = document.getElementById("sliders");
  slidersDiv.innerHTML = "";
  questions.forEach(q => {
    weights[q] = 0;
    const row = document.createElement("div");
    row.className = "question-row";
    row.innerHTML = `
      <label class="question-label">${q}: ${q}</label>
      <input type="range" min="-50" max="50" step="25" value="0" class="slider" id="slider-${q}" oninput="weights['${q}'] = parseInt(this.value)">
    `;
    slidersDiv.appendChild(row);
  });
}

function averageScore(row) {
  const total = questions.reduce((sum, q) => sum + (parseFloat(row[q]) || 0), 0);
  return Math.round(total / questions.length);
}

function calculateCustomRanking() {
  const subject = document.getElementById("subject-select").value;
  if (!subject) return;

  const filtered = allData.filter(r => r.Subject === subject);

  const originalSorted = [...filtered].sort((a, b) => averageScore(b) - averageScore(a));
  originalRanks = {};
  originalSorted.forEach((r, i) => originalRanks[r.Provider] = i + 1);

  const updated = filtered.map(row => {
    let weightedTotal = 0;
    let totalWeight = 0;
    questions.forEach(q => {
      const score = parseFloat(row[q]) || 0;
      const weight = (100 + weights[q]) / 100;
      weightedTotal += score * weight;
      totalWeight += weight;
    });
    const weightedScore = Math.round(weightedTotal / totalWeight);
    return {
      Provider: row.Provider,
      weightedScore,
      originalScore: averageScore(row),
      change: 0
    };
  });

  const finalSorted = [...updated].sort((a, b) => b.weightedScore - a.weightedScore);
  finalSorted.forEach((r, i) => {
    const newRank = i + 1;
    const oldRank = originalRanks[r.Provider];
    r.change = oldRank - newRank;
  });

  const tbody = document.querySelector("#results-table tbody");
  tbody.innerHTML = "";
  finalSorted.forEach((r, i) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${i + 1}</td>
      <td>${r.change > 0 ? "+" + r.change : r.change}</td>
      <td>${r.Provider}</td>
      <td>${r.weightedScore}%</td>
      <td>${r.originalScore}%</td>
    `;
    tbody.appendChild(row);
  });

  document.getElementById("results-table").style.display = "table";
}
</script>
