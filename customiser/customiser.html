---
layout: default
title: Customiser
---

<link href="https://unpkg.com/tabulator-tables@5.4.3/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@5.4.3/dist/js/tabulator.min.js"></script>

<style>
  body {
    font-family: 'Helvetica Neue', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #ffffff;
    color: #333;
  }

  .customiser-container {
    padding: 4rem 1rem;
    max-width: 1000px;
    margin: 0 auto;
    background-color: #f5f5ff;
    border-radius: 12px;
  }

  h2 {
    text-align: center;
    color: #3b0a66;
    font-size: 2.2rem;
    margin-bottom: 2rem;
  }

  .form-group {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
    font-size: 1.6rem;
  }

  #subject-select {
    padding: 0.5rem 1rem;
    font-size: 1.4rem;
    width: 300px;
  }

  .question-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 1.4rem;
    margin-top: 2rem;
  }

  .question-table th, .question-table td {
    border: 1px solid #ccc;
    padding: 0.75rem;
    text-align: center;
  }

  .question-table th {
    background-color: #eee;
  }

  .slider {
    width: 100%;
  }

  .submit-btn {
    background-color: #3b0a66;
    color: white;
    padding: 1rem 2rem;
    font-size: 1.4rem;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 2rem;
    display: none;
  }

  .submit-btn:enabled {
    display: inline-block;
  }

  .results-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 3rem;
    font-size: 1.4rem;
  }

  .results-table th, .results-table td {
    border: 1px solid #ccc;
    padding: 0.75rem;
    text-align: center;
  }

  .results-table th {
    background-color: #eee;
  }
</style>

<div class="customiser-container">
  <h2>Customise Your Subject Rankings</h2>
  <div class="form-group">
    <label for="subject-select">Choose Subject Area:</label>
    <select id="subject-select">
      <option value="">-- Select a Subject --</option>
    </select>
  </div>

  <form id="weights-form" style="display:none">
    <table class="question-table">
      <thead>
        <tr>
          <th>Question</th>
          <th>Importance</th>
        </tr>
      </thead>
      <tbody id="question-body">
      </tbody>
    </table>
    <button type="submit" class="submit-btn" id="submit-btn">Submit</button>
  </form>

  <div id="results"></div>
</div>

<script>
  let allData = [];
  let subjectDataMap = {};
  let defaultRanks = {};
  let questions = [];

  fetch("../assets/tables/All-Subjects-Formatted.json")
    .then(res => res.json())
    .then(data => {
      allData = data;
      const subjectSelect = document.getElementById("subject-select");
      const subjects = [...new Set(data.map(row => row.Subject))].sort();

      subjects.forEach(subject => {
        const option = document.createElement("option");
        option.value = subject;
        option.textContent = subject;
        subjectSelect.appendChild(option);
      });

      const sample = data.find(r => r.Subject);
      questions = Object.keys(sample).filter(k => /^Q\d+/.test(k));

      subjectSelect.addEventListener("change", () => {
        const selected = subjectSelect.value;
        if (!selected) return;
        document.getElementById("weights-form").style.display = "block";

        const tbody = document.getElementById("question-body");
        tbody.innerHTML = "";

        questions.forEach(q => {
          const tr = document.createElement("tr");

          const tdLabel = document.createElement("td");
          tdLabel.textContent = q + ": " + sample[q];
          tr.appendChild(tdLabel);

          const tdInput = document.createElement("td");
          const slider = document.createElement("input");
          slider.type = "range";
          slider.min = -2;
          slider.max = 2;
          slider.value = 0;
          slider.step = 1;
          slider.className = "slider";
          slider.name = q;
          tdInput.appendChild(slider);
          tr.appendChild(tdInput);

          tbody.appendChild(tr);
        });

        document.getElementById("submit-btn").disabled = false;
        document.getElementById("submit-btn").style.display = "inline-block";
      });

      document.getElementById("weights-form").addEventListener("submit", function(e) {
        e.preventDefault();
        const subject = subjectSelect.value;
        const subjectData = allData.filter(row => row.Subject === subject);

        const weights = {};
        document.querySelectorAll("input.slider").forEach(input => {
          weights[input.name] = parseInt(input.value) * 25;
        });

        subjectData.forEach(row => {
          let total = 0;
          let count = 0;
          questions.forEach(q => {
            if (row[q] !== undefined && typeof row[q] === 'number') {
              const weightFactor = 1 + (weights[q] || 0) / 100;
              total += row[q] * weightFactor;
              count++;
            }
          });
          row.weightedScore = count ? total / count : 0;
        });

        const sorted = [...subjectData].sort((a, b) => b.weightedScore - a.weightedScore);
        const original = [...subjectData].sort((a, b) => b.AVERAGE - a.AVERAGE);
        original.forEach((row, idx) => defaultRanks[row.Provider] = idx + 1);

        const resultsHTML = `
          <table class="results-table">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Change</th>
                <th>University</th>
                <th>Weighted Score</th>
                <th>Original Score</th>
              </tr>
            </thead>
            <tbody>
              ${sorted.map((row, i) => {
                const newRank = i + 1;
                const originalRank = defaultRanks[row.Provider];
                const diff = originalRank - newRank;
                const changeText = diff > 0 ? `+${diff}` : diff < 0 ? `${diff}` : "0";
                return `
                  <tr>
                    <td>${newRank}</td>
                    <td>${changeText}</td>
                    <td>${row.Provider}</td>
                    <td>${Math.round(row.weightedScore)}%</td>
                    <td>${Math.round(row.AVERAGE)}%</td>
                  </tr>
                `;
              }).join("")}
            </tbody>
          </table>
        `;
        document.getElementById("results").innerHTML = resultsHTML;
      });
    });
</script>
