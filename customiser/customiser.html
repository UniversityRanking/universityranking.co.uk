---
layout: default
title: Customiser
---

<link href="https://unpkg.com/tabulator-tables@5.4.3/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@5.4.3/dist/js/tabulator.min.js"></script>

<style>
  body {
    font-family: 'Helvetica Neue', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #ffffff;
    color: #333;
  }

  .hero {
    background-color: #3b0a66;
    padding: 4rem 1rem 2rem 1rem;
    text-align: center;
    color: white;
  }

  .customiser-title {
    font-size: 2.2rem;
    margin-bottom: 1rem;
  }

  .form-group {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    font-size: 1.6rem;
    margin-bottom: 1rem;
  }

  #subject-select {
    font-size: 1.4rem;
    padding: 0.6rem 1.2rem;
    border-radius: 6px;
  }

  .customiser-container {
    padding: 2rem 1rem 4rem 1rem;
    max-width: 1000px;
    margin: -3rem auto 0 auto;
    background-color: #ffffff;
    border-radius: 20px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
  }

  .question-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 1.4rem;
    margin-top: 2rem;
    background-color: #fff;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }

  .question-table th,
  .question-table td {
    border: 1px solid #ccc;
    padding: 0.75rem;
  }

  .question-table th {
    background-color: #eee;
    text-align: center;
  }

  .question-table td:first-child {
    text-align: left;
    color: #333;
  }

  .slider {
    width: 100%;
  }

  .submit-btn {
    background-color: #3b0a66;
    color: white;
    padding: 1rem 2rem;
    font-size: 1.4rem;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 2rem;
    display: inline-block;
  }

  .results-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 3rem;
    font-size: 1.4rem;
  }

  .results-table th,
  .results-table td {
    border: 1px solid #ccc;
    padding: 0.75rem;
    text-align: center;
  }

  .results-table th {
    background-color: #eee;
  }
</style>

<div class="hero">
  <h2 class="customiser-title">Customise Your Subject Rankings</h2>
  <div class="form-group">
    <label for="subject-select">Choose Subject Area:</label>
    <select id="subject-select">
      <option value="">-- Select a Subject --</option>
    </select>
  </div>
</div>

<div class="customiser-container">
  <form id="weights-form">
    <table class="question-table">
      <thead>
        <tr>
          <th>Question</th>
          <th>Importance</th>
        </tr>
      </thead>
      <tbody id="question-body">
      </tbody>
    </table>
    <button type="submit" class="submit-btn" id="submit-btn">Submit</button>
  </form>

  <div id="results"></div>
</div>

<script>
  let allData = [];
  let defaultRanks = {};
  let questions = [];

  fetch("../assets/tables/All-Subjects-Formatted.json")
    .then(res => res.json())
    .then(data => {
      allData = data;
      const subjectSelect = document.getElementById("subject-select");
      const subjects = [...new Set(data.map(row => row.Subject))].sort();

      subjects.forEach(subject => {
        const option = document.createElement("option");
        option.value = subject;
        option.textContent = subject;
        subjectSelect.appendChild(option);
      });

      const sample = data.find(r => r.Subject);
      questions = Object.keys(sample).filter(k => /^Q\d+/.test(k));

      subjectSelect.addEventListener("change", () => {
        const selected = subjectSelect.value;
        if (!selected) return;

        const tbody = document.getElementById("question-body");
        tbody.innerHTML = "";

        questions.forEach(q => {
          const tr = document.createElement("tr");
          const tdLabel = document.createElement("td");
          tdLabel.textContent = sample[q];
          const tdInput = document.createElement("td");
          const slider = document.createElement("input");
          slider.type = "range";
          slider.min = -2;
          slider.max = 2;
          slider.value = 0;
          slider.step = 1;
          slider.className = "slider";
          slider.name = q;
          tdInput.appendChild(slider);
          tr.appendChild(tdLabel);
          tr.appendChild(tdInput);
          tbody.appendChild(tr);
        });
      });

      document.getElementById("weights-form").addEventListener("submit", function(e) {
        e.preventDefault();
        const subject = subjectSelect.value;
        const subjectData = allData.filter(row => row.Subject === subject);

        const weights = {};
        document.querySelectorAll("input.slider").forEach(input => {
          weights[input.name] = parseInt(input.value) * 25;
        });

        subjectData.forEach(row => {
          let total = 0;
          let count = 0;
          questions.forEach(q => {
            if (row[q] !== undefined && typeof row[q] === 'number') {
              total += row[q];
              count++;
            }
          });
          row.originalScore = count ? total / count : 0;
        });

        const originalSorted = [...subjectData].sort((a, b) => b.originalScore - a.originalScore);
        originalSorted.forEach((row, idx) => defaultRanks[row.Provider] = idx + 1);

        subjectData.forEach(row => {
          let total = 0;
          let count = 0;
          questions.forEach(q => {
            if (row[q] !== undefined && typeof row[q] === 'number') {
              const weightFactor = 1 + (weights[q] || 0) / 100;
              total += row[q] * weightFactor;
              count++;
            }
          });
          row.weightedScore = count ? total / count : 0;
        });

        const sorted = [...subjectData].sort((a, b) => b.weightedScore - a.weightedScore);

        const resultsHTML = `
          <table class="results-table">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Change</th>
                <th>University</th>
                <th>Weighted Score</th>
                <th>Original Score</th>
              </tr>
            </thead>
            <tbody>
              ${sorted.map((row, i) => {
                const newRank = i + 1;
                const originalRank = defaultRanks[row.Provider];
                const diff = originalRank - newRank;
                const changeText = diff > 0 ? `+${diff}` : diff < 0 ? `${diff}` : "0";
                const weighted = typeof row.weightedScore === 'number' ? row.weightedScore.toFixed(2) + "%" : "–";
                const original = typeof row.originalScore === 'number' ? row.originalScore.toFixed(2) + "%" : "–";

                return `
                  <tr>
                    <td>${newRank}</td>
                    <td>${changeText}</td>
                    <td>${row.Provider}</td>
                    <td>${weighted}</td>
                    <td>${original}</td>
                  </tr>
                `;
              }).join("")}
            </tbody>
          </table>
        `;
        document.getElementById("results").innerHTML = resultsHTML;
      });
    });
</script>
