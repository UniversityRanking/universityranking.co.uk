---
layout: default
title: Customiser
---

<link href="https://unpkg.com/tabulator-tables@5.4.3/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@5.4.3/dist/js/tabulator.min.js"></script>

<style>
  body {
    font-family: 'Helvetica Neue', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #ffffff;
    color: #333;
  }

  .hero {
    background-color: #3b0a66;
    padding: 5rem 1rem 3rem 1rem;
    text-align: center;
    color: white;
  }

  .customiser-section {
    background-color: #f5f5ff;
    padding: 4rem 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .customiser-container {
    width: 1000px;
    max-width: 95%;
    background: white;
    border-radius: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    padding: 2rem;
  }

  .customiser-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 2rem;
  }

  .customiser-table th,
  .customiser-table td {
    padding: 0.75rem;
    border-bottom: 1px solid #ddd;
    text-align: left;
  }

  .customiser-table input[type=range] {
    width: 100%;
  }

  .results-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 3rem;
    font-size: 1.1rem;
  }

  .results-table th,
  .results-table td {
    padding: 0.75rem;
    border-bottom: 1px solid #ddd;
    text-align: left;
  }

  .score-green { color: #2e7d32; font-weight: bold; }
  .score-orange { color: #ef6c00; font-weight: bold; }
  .score-red { color: #c62828; font-weight: bold; }
</style>

<section class="hero">
  <h2 class="compare-title">Customise Your Ranking</h2>
</section>

<section class="customiser-section">
  <div class="customiser-container">
    <label for="subject-select"><strong>Select Subject:</strong></label>
    <select id="subject-select">
      <option value="">Select subject</option>
    </select>

    <table class="customiser-table" id="weight-table"></table>

    <button onclick="applyWeightings()">Submit</button>

    <table class="results-table" id="results-table" style="display:none">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Change</th>
          <th>University</th>
          <th>Weighted Score</th>
          <th>Original Score</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<script>
let allData = [];
let subjectDataMap = {};
let questionKeys = [];
let originalRanks = [];
const weights = {};
const scaleMap = {
  '-2': -0.5,
  '-1': -0.25,
   '0': 0,
   '1': 0.25,
   '2': 0.5
};

fetch("../assets/tables/All-Subjects-Formatted.json")
  .then(res => res.json())
  .then(data => {
    allData = data;

    data.forEach(row => {
      if (!subjectDataMap[row.Subject]) {
        subjectDataMap[row.Subject] = [];
      }
      subjectDataMap[row.Subject].push(row);
    });

    const subjects = Object.keys(subjectDataMap).sort();
    const select = document.getElementById("subject-select");
    subjects.forEach(sub => {
      const opt = document.createElement("option");
      opt.value = sub;
      opt.textContent = sub;
      select.appendChild(opt);
    });

    select.addEventListener("change", renderWeightTable);
  });

function renderWeightTable() {
  const subject = document.getElementById("subject-select").value;
  if (!subject) return;
  const table = document.getElementById("weight-table");
  table.innerHTML = "<tr><th>Question</th><th>Importance</th></tr>";

  const sample = subjectDataMap[subject][0];
  questionKeys = Object.keys(sample).filter(k => /^Q\d+/.test(k));

  questionKeys.forEach(k => {
    weights[k] = 0; // default neutral
    const tr = document.createElement("tr");

    const label = document.createElement("td");
    label.textContent = k;

    const sliderCell = document.createElement("td");
    const slider = document.createElement("input");
    slider.type = "range";
    slider.min = -2;
    slider.max = 2;
    slider.step = 1;
    slider.value = 0;
    slider.oninput = () => weights[k] = parseInt(slider.value);
    sliderCell.appendChild(slider);

    tr.appendChild(label);
    tr.appendChild(sliderCell);
    table.appendChild(tr);
  });
}

function applyWeightings() {
  const subject = document.getElementById("subject-select").value;
  if (!subject) return;
  const universities = subjectDataMap[subject];

  const results = universities.map(u => {
    let total = 0;
    let validCount = 0;

    questionKeys.forEach(k => {
      if (u[k] !== undefined && typeof u[k] === 'number') {
        total += u[k] * (1 + scaleMap[weights[k]]);
        validCount++;
      }
    });

    const weightedScore = validCount ? total / validCount : 0;
    const originalScore = validCount ? questionKeys.reduce((sum, k) => sum + (u[k] || 0), 0) / validCount : 0;

    return {
      Provider: u.Provider,
      Weighted: Math.round(weightedScore),
      Original: Math.round(originalScore)
    };
  });

  const sortedOriginal = [...results].sort((a, b) => b.Original - a.Original);
  originalRanks = sortedOriginal.map(u => u.Provider);

  const sorted = results.sort((a, b) => b.Weighted - a.Weighted);

  const table = document.querySelector("#results-table tbody");
  table.innerHTML = "";
  document.getElementById("results-table").style.display = "table";

  sorted.forEach((u, i) => {
    const tr = document.createElement("tr");

    const rankCell = document.createElement("td");
    rankCell.textContent = i + 1;

    const changeCell = document.createElement("td");
    const originalRank = originalRanks.indexOf(u.Provider) + 1;
    const diff = originalRank - (i + 1);
    changeCell.textContent = diff === 0 ? "â€“" : (diff > 0 ? `+${diff}` : diff);

    const nameCell = document.createElement("td");
    nameCell.textContent = u.Provider;

    const weightedCell = document.createElement("td");
    weightedCell.textContent = `${u.Weighted}%`;
    weightedCell.className = u.Weighted >= 85 ? "score-green" : u.Weighted >= 70 ? "score-orange" : "score-red";

    const originalCell = document.createElement("td");
    originalCell.textContent = `${u.Original}%`;

    tr.appendChild(rankCell);
    tr.appendChild(changeCell);
    tr.appendChild(nameCell);
    tr.appendChild(weightedCell);
    tr.appendChild(originalCell);
    table.appendChild(tr);
  });
}
</script>
