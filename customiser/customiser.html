---
layout: default
title: Customiser
---

<!-- Load Tabulator for future proofing -->
<link href="https://unpkg.com/tabulator-tables@5.4.3/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@5.4.3/dist/js/tabulator.min.js"></script>

<style>
  body {
    font-family: 'Helvetica Neue', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #ffffff;
    color: #333;
  }

  .hero {
    background-color: #3b0a66;
    padding: 5rem 1rem 3rem 1rem;
    text-align: center;
    color: white;
  }

  .customiser-section {
    background-color: #f5f5ff;
    padding: 4rem 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .customiser-container {
    width: 100%;
    max-width: 1000px;
    background: white;
    border-radius: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    padding: 2rem;
  }

  .question-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 1rem 0;
  }

  .question-label {
    flex: 2;
    font-size: 1rem;
  }

  .slider-cell {
    flex: 1;
    text-align: right;
  }

  .customiser-select {
    font-size: 1.2rem;
    padding: 0.6rem 1rem;
    width: 300px;
    margin-bottom: 2rem;
  }

  .customiser-submit {
    background-color: #3b0a66;
    color: white;
    border: none;
    padding: 0.8rem 2rem;
    font-size: 1.2rem;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 2rem;
    margin-bottom: 3rem;
  }

  .results-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 1rem;
  }

  .results-table th, .results-table td {
    border: 1px solid #ccc;
    padding: 0.8rem;
    text-align: center;
  }

  .results-table th {
    background-color: #eee;
  }
</style>

<section class="hero">
  <h2 class="compare-title">Customise Your University Rankings</h2>
</section>

<section class="customiser-section">
  <select id="subject-select" class="customiser-select">
    <option value="">Select Subject</option>
  </select>

  <div id="customiser-container" class="customiser-container" style="display: none;"></div>

  <button id="submit-btn" class="customiser-submit">Submit</button>

  <div id="results-container" class="customiser-container" style="margin-top: 2rem;"></div>
</section>

<script>
let data = [];
let questions = [];
let defaultRanks = [];

fetch("../assets/tables/All-Subjects-Formatted.json")
  .then(res => res.json())
  .then(json => {
    data = json;

    const subjects = [...new Set(json.map(row => row.Subject))].sort();
    const subjectSelect = document.getElementById("subject-select");
    subjects.forEach(sub => {
      const opt = document.createElement("option");
      opt.value = sub;
      opt.textContent = sub;
      subjectSelect.appendChild(opt);
    });

    const sample = json.find(r => r.Subject);
    questions = Object.keys(sample).filter(k => /^Q\d+/.test(k)).map(k => ({ key: k, label: sample[k] }));
  });

document.getElementById("subject-select").addEventListener("change", e => {
  const selected = e.target.value;
  const container = document.getElementById("customiser-container");
  container.innerHTML = "";
  if (!selected) return (container.style.display = "none");
  container.style.display = "block";

  questions.forEach(q => {
    const row = document.createElement("div");
    row.className = "question-row";

    const label = document.createElement("div");
    label.className = "question-label";
    label.textContent = q.label;
    row.appendChild(label);

    const sliderCell = document.createElement("div");
    sliderCell.className = "slider-cell";
    const input = document.createElement("input");
    input.type = "range";
    input.min = -50;
    input.max = 50;
    input.step = 25;
    input.value = 0;
    input.dataset.key = q.key;
    sliderCell.appendChild(input);
    row.appendChild(sliderCell);

    container.appendChild(row);
  });
});

document.getElementById("submit-btn").addEventListener("click", () => {
  const selectedSubject = document.getElementById("subject-select").value;
  if (!selectedSubject) return;

  const sliders = document.querySelectorAll("#customiser-container input[type='range']");
  const weights = {};
  sliders.forEach(slider => {
    weights[slider.dataset.key] = parseFloat(slider.value) / 100 + 1;
  });

  const entries = data.filter(row => row.Subject === selectedSubject);
  const baseScores = entries.map(row => {
    const avg = questions.reduce((sum, q) => sum + (row[q.key] || 0), 0) / questions.length;
    return { Provider: row.Provider, score: avg };
  });

  baseScores.sort((a, b) => b.score - a.score);
  defaultRanks = baseScores.map(entry => entry.Provider);

  const results = entries.map(row => {
    let sum = 0;
    let totalWeight = 0;
    questions.forEach(q => {
      const score = row[q.key] || 0;
      const weight = weights[q.key];
      sum += score * weight;
      totalWeight += weight;
    });
    const weightedScore = sum / totalWeight;
    return {
      Provider: row.Provider,
      weighted: Math.round(weightedScore),
      original: Math.round(baseScores.find(r => r.Provider === row.Provider)?.score || 0)
    };
  });

  results.sort((a, b) => b.weighted - a.weighted);

  const html = [`<table class="results-table"><thead><tr><th>Rank</th><th>Change</th><th>University</th><th>Weighted Score</th><th>Original Score</th></tr></thead><tbody>`];
  results.forEach((r, i) => {
    const originalRank = defaultRanks.indexOf(r.Provider) + 1;
    const change = originalRank - (i + 1);
    html.push(`<tr><td>${i + 1}</td><td>${change > 0 ? "+" + change : change}</td><td>${r.Provider}</td><td>${r.weighted}%</td><td>${r.original}%</td></tr>`);
  });
  html.push("</tbody></table>");
  document.getElementById("results-container").innerHTML = html.join("");
});
</script>
