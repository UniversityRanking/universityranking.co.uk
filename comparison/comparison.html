---
layout: default
title: Compare
---

<!-- Load Tabulator (not needed anymore since we're using plain tables) -->

<style>
  body {
    font-family: 'Helvetica Neue', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #ffffff;
    color: #333;
  }

  .compare-section {
    padding: 2rem 1rem 4rem;
    background-color: #f5efff;
  }

  .compare-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 1.4rem;
    margin-top: 2rem;
  }

  .compare-table th,
  .compare-table td {
    padding: 1rem;
    border-bottom: 1px solid #ccc;
    text-align: center;
  }

  .compare-table th {
    background-color: #fff;
    font-weight: bold;
    text-align: center;
  }

  .compare-table select {
    font-size: 1.4rem;
    padding: 0.4rem;
  }

  .score-green {
    color: #2e7d32;
    font-weight: bold;
  }
  .score-orange {
    color: #ef6c00;
    font-weight: bold;
  }
  .score-red {
    color: #c62828;
    font-weight: bold;
  }
  .compare-table select {
  width: 160px;         /* Set a max width */
  max-width: 100%;      /* Prevent overflow */
  font-size: 1.2rem;    /* Optional: make it more compact */
  }
</style>

<section class="compare-section">
  <div class="container">
    <h1 style="text-align:center">Compare University Scores</h1>
    <table class="compare-table">
      <thead>
        <tr>
          <th>Question</th>
          <th>
            <select id="subject1"></select>
            <br>
            <select id="university1" disabled></select>
          </th>
          <th>
            <select id="subject2"></select>
            <br>
            <select id="university2" disabled></select>
          </th>
          <th>
            <select id="subject3"></select>
            <br>
            <select id="university3" disabled></select>
          </th>
        </tr>
      </thead>
      <tbody id="compare-body">
        <!-- JS will populate -->
      </tbody>
    </table>
  </div>
</section>

<script>
let allData = [];
let questionLabels = [];

function getColorClass(score) {
  if (score >= 85) return "score-green";
  if (score >= 70) return "score-orange";
  return "score-red";
}

function populateSubjects(subjectSelects, data) {
  const subjects = [...new Set(data.map(row => row.Subject))].sort();
  subjectSelects.forEach(select => {
    select.innerHTML = '<option value="">Select subject</option>';
    subjects.forEach(subject => {
      const option = document.createElement("option");
      option.value = subject;
      option.textContent = subject;
      select.appendChild(option);
    });
  });
}

function populateUniversities(subject, universitySelect) {
  const filtered = allData.filter(row => row.Subject === subject);
  const providers = [...new Set(filtered.map(row => row.Provider))].sort();
  universitySelect.innerHTML = '<option value="">Select university</option>';
  providers.forEach(provider => {
    const option = document.createElement("option");
    option.value = provider;
    option.textContent = provider;
    universitySelect.appendChild(option);
  });
  universitySelect.disabled = false;
}

function updateCompareTable() {
  const selections = [1, 2, 3].map(i => {
    return {
      subject: document.getElementById(`subject${i}`).value,
      university: document.getElementById(`university${i}`).value
    };
  });

  const tbody = document.getElementById("compare-body");
  tbody.innerHTML = "";

  questionLabels.forEach(q => {
    const row = document.createElement("tr");

    const labelCell = document.createElement("td");
    labelCell.textContent = `${q.number}: ${q.label}`;
    row.appendChild(labelCell);

    selections.forEach(({subject, university}) => {
      const cell = document.createElement("td");
      if (!subject || !university) {
        cell.textContent = "—";
      } else {
        const record = allData.find(row => row.Subject === subject && row.Provider === university);
        if (record && record[q.number] !== undefined) {
          const score = Math.round(record[q.number]);
          cell.textContent = score + "%";
          cell.className = getColorClass(score);
        } else {
          cell.textContent = "—";
        }
      }
      row.appendChild(cell);
    });

    tbody.appendChild(row);
  });
}

fetch("../assets/tables/All-Subjects-Formatted.json")
  .then(res => res.json())
  .then(data => {
    allData = data;
    const sample = data.find(d => d.Subject);
    questionLabels = Object.keys(sample)
      .filter(k => k.startsWith("Q"))
      .map(k => ({ number: k, label: sample[k + " Label"] || k }));

    populateSubjects([
      document.getElementById("subject1"),
      document.getElementById("subject2"),
      document.getElementById("subject3")
    ], allData);

    updateCompareTable();

    [1, 2, 3].forEach(i => {
      const subjectEl = document.getElementById(`subject${i}`);
      const uniEl = document.getElementById(`university${i}`);

      subjectEl.addEventListener("change", () => {
        if (subjectEl.value) {
          populateUniversities(subjectEl.value, uniEl);
        } else {
          uniEl.innerHTML = '<option value="">Select university</option>';
          uniEl.disabled = true;
        }
        updateCompareTable();
      });

      uniEl.addEventListener("change", () => {
        updateCompareTable();
      });
    });
  });
</script>
