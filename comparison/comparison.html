---
layout: default
title: Compare
---

<!-- Load Tabulator (not needed now but kept for consistency) -->
<link href="https://unpkg.com/tabulator-tables@5.4.3/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@5.4.3/dist/js/tabulator.min.js"></script>

<style>
  body {
    font-family: 'Helvetica Neue', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #ffffff;
    color: #333;
  }

  .hero {
    background-color: #3b0a66;
    padding: 5rem 1rem 12rem 1rem;
    text-align: center;
    color: white;
  }

  .compare-section {
    background-color: #f5f5ff;
    margin-top: -4rem;
    padding: 4rem 1rem 4rem 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .compare-title {
    color: white;
    font-size: 2rem;
    font-weight: bold;
    margin-top: 0rem;
    margin-bottom: 2rem;
    z-index: 2;
    position: relative;
  }

.compare-table {
  width: 1000px;
  border-collapse: collapse;
  font-size: 1.4rem;
  background: white;
  border-radius: 20px 20px 0 0;
  overflow: hidden;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  position: relative;
  top: -2.5cm; /* pulls the table upward by approx 2cm */
}

  .compare-table th,
  .compare-table td {
    padding: 1rem;
    border-bottom: 1px solid #ddd;
    text-align: center;
  }

  .compare-table th {
    background-color: #fff;
    font-weight: bold;
    text-align: center;
  }

  .compare-table select {
    width: 160px;
    max-width: 100%;
    font-size: 1.2rem;
  }

  .score-green {
    color: #2e7d32;
    font-weight: bold;
  }
  .score-orange {
    color: #ef6c00;
    font-weight: bold;
  }
  .score-red {
    color: #c62828;
    font-weight: bold;
  }
</style>

<section class="hero">
  <h2 class="compare-title">Compare University Scores</h2>
</section>

<section class="compare-section">
  <table class="compare-table">
    <thead>
      <tr>
        <th>Question</th>
        <th>
          <select id="subject-1">
            <option value="">Select subject</option>
          </select><br>
          <select id="university-1" disabled>
            <option value="">Select university</option>
          </select>
        </th>
        <th>
          <select id="subject-2">
            <option value="">Select subject</option>
          </select><br>
          <select id="university-2" disabled>
            <option value="">Select university</option>
          </select>
        </th>
        <th>
          <select id="subject-3">
            <option value="">Select subject</option>
          </select><br>
          <select id="university-3" disabled>
            <option value="">Select university</option>
          </select>
        </th>
      </tr>
    </thead>
    <tbody id="compare-body">
      <!-- Questions and scores will be inserted here -->
    </tbody>
  </table>
</section>

<script>
  const subjects = new Set();
  const subjectDataMap = {};
  let questions = [];

  fetch("../assets/tables/All-Subjects-Formatted.json")
    .then(res => res.json())
    .then(data => {
      data.forEach(row => {
        subjects.add(row.Subject);
        if (!subjectDataMap[row.Subject]) {
          subjectDataMap[row.Subject] = [];
        }
        subjectDataMap[row.Subject].push(row);
      });

      const sortedSubjects = Array.from(subjects).sort();

      [1, 2, 3].forEach(i => {
        const subjectSelect = document.getElementById(`subject-${i}`);
        sortedSubjects.forEach(sub => {
          const option = document.createElement("option");
          option.value = sub;
          option.textContent = sub;
          subjectSelect.appendChild(option);
        });
      });

      const sample = data.find(r => r.Subject);
      questions = Object.keys(sample).filter(k => /^Q\d+/.test(k)).map(k => ({
        key: k,
        label: sample[k] // directly use the sample[k] text as label
      }));

      renderEmptyTable();

      [1, 2, 3].forEach(i => {
        document.getElementById(`subject-${i}`).addEventListener("change", e => {
          const subject = e.target.value;
          const uniSelect = document.getElementById(`university-${i}`);
          uniSelect.innerHTML = '<option value="">Select university</option>';
          uniSelect.disabled = !subject;

          if (subject && subjectDataMap[subject]) {
            subjectDataMap[subject].forEach(row => {
              const opt = document.createElement("option");
              opt.value = row.Provider;
              opt.textContent = row.Provider;
              uniSelect.appendChild(opt);
            });
          }

          uniSelect.dispatchEvent(new Event("change"));
        });

        document.getElementById(`university-${i}`).addEventListener("change", updateTable);
      });
    });

  function renderEmptyTable() {
    const tbody = document.getElementById("compare-body");
    tbody.innerHTML = "";
    questions.forEach(q => {
      const tr = document.createElement("tr");
      const labelCell = document.createElement("td");
      labelCell.textContent = `${q.key}: ${q.label.replace(/:.*$/, "")}`;
      tr.appendChild(labelCell);
      for (let i = 0; i < 3; i++) {
        const cell = document.createElement("td");
        cell.textContent = "–";
        tr.appendChild(cell);
      }
      tbody.appendChild(tr);
    });
  }

  function updateTable() {
    const tbody = document.getElementById("compare-body");
    tbody.innerHTML = "";
    questions.forEach(q => {
      const tr = document.createElement("tr");
      const labelCell = document.createElement("td");
      labelCell.textContent = `${q.key}: ${q.label}`;
      tr.appendChild(labelCell);

      [1, 2, 3].forEach(i => {
        const subject = document.getElementById(`subject-${i}`).value;
        const uni = document.getElementById(`university-${i}`).value;
        const cell = document.createElement("td");

        if (subject && uni && subjectDataMap[subject]) {
          const entry = subjectDataMap[subject].find(row => row.Provider === uni);
          if (entry && entry[q.key] !== undefined && typeof entry[q.key] === 'number') {
            const val = Math.round(entry[q.key]);
            cell.textContent = `${val}%`;
            cell.className = val >= 85 ? "score-green" : val >= 70 ? "score-orange" : "score-red";
          } else {
            cell.textContent = "–";
          }
        } else {
          cell.textContent = "–";
        }
        tr.appendChild(cell);
      });

      tbody.appendChild(tr);
    });
  }
</script>
