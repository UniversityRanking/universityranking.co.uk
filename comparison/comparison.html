---
layout: default
title: Compare
---

<!-- Load Tabulator (not needed here but retained for consistency) -->
<link href="https://unpkg.com/tabulator-tables@5.4.3/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@5.4.3/dist/js/tabulator.min.js"></script>

<style>
  body {
    font-family: 'Helvetica Neue', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #ffffff;
    color: #333;
  }

  .compare-section {
    background-color: #f5f5ff;
    margin-top: -5rem;
    padding: 10rem 1rem 4rem 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .compare-title {
    color: white;
    font-size: 2rem;
    font-weight: bold;
    text-align: center;
    margin-top: -6rem;
    margin-bottom: 2rem;
    z-index: 2;
    position: relative;
  }

  .compare-table {
    width: 1000px;
    border-collapse: collapse;
    font-size: 1.4rem;
    background: white;
    border-radius: 20px 20px 0 0;
    overflow: hidden;
    box-shadow: 0 0 10px rgba(0,0,0,0.05);
  }

  .compare-table th,
  .compare-table td {
    padding: 1rem;
    border-bottom: 1px solid #ddd;
    text-align: center;
    vertical-align: top;
  }

  .compare-table th {
    background-color: #fff;
    font-weight: bold;
    text-align: center;
  }

  .compare-table td:first-child,
  .compare-table th:first-child {
    text-align: left;
  }

  .compare-table select {
    width: 160px;
    max-width: 100%;
    font-size: 1.2rem;
  }

  .score-green {
    color: #2e7d32;
    font-weight: bold;
  }

  .score-orange {
    color: #ef6c00;
    font-weight: bold;
  }

  .score-red {
    color: #c62828;
    font-weight: bold;
  }
</style>

<section class="compare-section">
  <div class="compare-title">Compare University Scores</div>
  <table class="compare-table">
    <thead>
      <tr>
        <th>Question</th>
        <th>
          <select class="subject-select" data-index="0">
            <option value="">Select subject</option>
          </select><br>
          <select class="university-select" data-index="0" disabled>
            <option value="">Select university</option>
          </select>
        </th>
        <th>
          <select class="subject-select" data-index="1">
            <option value="">Select subject</option>
          </select><br>
          <select class="university-select" data-index="1" disabled>
            <option value="">Select university</option>
          </select>
        </th>
        <th>
          <select class="subject-select" data-index="2">
            <option value="">Select subject</option>
          </select><br>
          <select class="university-select" data-index="2" disabled>
            <option value="">Select university</option>
          </select>
        </th>
      </tr>
    </thead>
    <tbody id="compare-tbody">
      <!-- Questions and scores inserted here -->
    </tbody>
  </table>
</section>

<script>
  const questionOrder = [];
  const questionMap = {};
  const allData = [];
  const selectedUnis = [null, null, null];

  fetch("../assets/tables/All-Subjects-Formatted.json")
    .then(response => response.json())
    .then(data => {
      data.forEach(row => {
        allData.push(row);
        Object.keys(row).forEach(key => {
          if (key.startsWith("Q") && !(key in questionMap)) {
            questionOrder.push(key);
            questionMap[key] = row[key.replace(/Q\d+: /, '')];
          }
        });
      });

      const uniqueSubjects = [...new Set(allData.map(row => row.Subject))].sort();
      document.querySelectorAll('.subject-select').forEach(select => {
        uniqueSubjects.forEach(subject => {
          const opt = document.createElement('option');
          opt.value = subject;
          opt.textContent = subject;
          select.appendChild(opt);
        });
      });

      renderTable();
    });

  function renderTable() {
    const tbody = document.getElementById("compare-tbody");
    tbody.innerHTML = "";
    questionOrder.forEach(q => {
      const tr = document.createElement("tr");
      const tdQuestion = document.createElement("td");
      tdQuestion.textContent = `${q}: ${questionMap[q]}`;
      tr.appendChild(tdQuestion);

      for (let i = 0; i < 3; i++) {
        const td = document.createElement("td");
        if (selectedUnis[i]) {
          const value = selectedUnis[i][q];
          if (typeof value === "number") {
            const rounded = Math.round(value);
            td.textContent = rounded + "%";
            td.className = rounded >= 85 ? "score-green" : rounded >= 70 ? "score-orange" : "score-red";
          } else {
            td.textContent = "–";
          }
        } else {
          td.textContent = "–";
        }
        tr.appendChild(td);
      }

      tbody.appendChild(tr);
    });
  }

  document.querySelectorAll('.subject-select').forEach(subjectSelect => {
    subjectSelect.addEventListener('change', function () {
      const index = parseInt(this.dataset.index);
      const uniSelect = document.querySelector(`.university-select[data-index='${index}']`);
      uniSelect.innerHTML = '<option value="">Select university</option>';
      uniSelect.disabled = true;
      selectedUnis[index] = null;

      const chosenSubject = this.value;
      if (!chosenSubject) {
        renderTable();
        return;
      }

      const filtered = allData.filter(row => row.Subject === chosenSubject);
      filtered.forEach(row => {
        const opt = document.createElement('option');
        opt.value = row.Provider;
        opt.textContent = row.Provider;
        uniSelect.appendChild(opt);
      });

      uniSelect.disabled = false;
    });
  });

  document.querySelectorAll('.university-select').forEach(uniSelect => {
    uniSelect.addEventListener('change', function () {
      const index = parseInt(this.dataset.index);
      const subject = document.querySelector(`.subject-select[data-index='${index}']`).value;
      const uni = this.value;

      if (!uni || !subject) {
        selectedUnis[index] = null;
        renderTable();
        return;
      }

      selectedUnis[index] = allData.find(row => row.Subject === subject && row.Provider === uni);
      renderTable();
    });
  });
</script>
